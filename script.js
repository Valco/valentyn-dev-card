// ==== I18N ====

const translations = {
  uk: {
    site_title: "Профіль розробника",
    name_ua: "Валентин Ярмолатій",
    name_en: "Valentyn Yarmolatiy",
    hero_eyebrow: "Мобільні застосунки • IoT • 3D-друк",
    hero_subtitle: "Розробник мобільних застосунків та IoT-рішень",
    hero_body:
      "Працюю на перетині мобільної розробки, 3D-друку та електроніки. Створюю застосунки та розумні пристрої, які працюють разом як єдина система.",
    hero_chip: "Основні напрями",
    hero_item_1: "Мобільні застосунки з бекенд-інтеграціями",
    hero_item_2: "ESP32 / Arduino пристрої з Wi-Fi підключенням",
    hero_item_3: "Функціональні вироби на базі 3D-друку",
    btn_appstore: "Профіль в App Store",
    btn_contact: "Написати мені",

    about_title: "Про мене",
    about_body_1:
      "Основний напрямок моєї роботи — 3D-друк технологічних виробів, які поєднуються з електронними компонентами й перетворюються на готові пристрої. Це можуть бути розумні світильники, інтерактивні мапи чи спеціалізовані корпуси для IoT-проєктів.",
    about_body_2:
      "Як хобі та для підтримки професійного розвитку я вивчаю та використовую Flutter, Android, iOS, Arduino/ESP32. Мені цікаві продукти, де мобільний застосунок, «залізо» та 3D-друк працюють разом і створюють зрозумілий досвід для користувача.",

    skills_title: "Чим я займаюсь",
    skill_app_title: "Мобільні застосунки",
    skill_app_body:
      "Створюю застосунки, які працюють разом із сервером або хмарними сервісами. Мене цікавлять інструменти для клубів, освітніх програм та керування розумними пристроями.",
    skill_iot_title: "ESP32 / Arduino пристрої",
    skill_iot_body:
      "Розробляю прошивки для ESP32 та Arduino, інтегрую LED-системи, датчики та Wi-Fi-функціонал. Пристрої можуть працювати автономно або під керуванням мобільного застосунку.",
    skill_3d_title: "Функціональний 3D-друк",
    skill_3d_body:
      "Проєктую й друкую корпуси, декоративні та утилітарні елементи для електроніки. Поєдную вигляд виробу з його функціональністю та зручністю в реальному використанні.",

    hobbies_title: "Хоббі та інтереси",
    hobbies_body:
      "Мені подобається поєднувати 3D-друк, електроніку та програмування в цілісні проєкти. Окремий напрямок — робота з LED-пристроями: розумні світильники, мапи України з індикацією повітряних тривог, персоналізовані подарункові вироби.",

    portfolio_title: "Портфоліо (фрагменти)",
    portfolio_awana_title: "AWANA Helper",
    portfolio_awana_body:
      "Мобільний застосунок для лідерів клубів AWANA. Допомагає планувати заняття, ігри та активності, зберігаючи структуру зустрічей у зручному форматі.",
    portfolio_map_title: "Мапа повітряної тривоги України",
    portfolio_map_body:
      "Розумний LED-світильник у формі мапи України. Пристрій через інтернет відображає статус повітряних тривог по регіонах та може автоматично зменшувати яскравість у нічному режимі.",
    portfolio_lith_title: "3D-друкований світильник-літфото",
    portfolio_lith_body:
      "Персоналізований куб-світильник, надрукований у техніці літфото. Зображення проявляється при підсвічуванні зсередини й перетворюється на атмосферний подарунок.",

    contact_title: "Звʼязатися зі мною",
    contact_body:
      "Якщо вам потрібен розробник, який поєднає 3D-друк, електроніку та мобільний застосунок в одному проєкті, — напишіть мені через форму нижче.",
    field_name_label: "Імʼя",
    field_email_label: "Email",
    field_message_label: "Повідомлення",
    btn_send: "Надіслати повідомлення",
    footer_text:
      "© {{year}} Валентин Ярмолатій · Мобільні застосунки, 3D-друк та IoT-рішення",
    form_success: "Дякую! Ваше повідомлення надіслано.",
    form_error:
      "Сталася помилка під час надсилання. Спробуйте ще раз пізніше.",
    form_sending: "Надсилаю повідомлення..."
  },

  en: {
    site_title: "Developer Profile",
    name_ua: "Valentyn Yarmolatiy",
    name_en: "Valentyn Yarmolatiy",
    hero_eyebrow: "Mobile apps • IoT • 3D printing",
    hero_subtitle: "Mobile apps & IoT solutions developer",
    hero_body:
      "I work at the intersection of mobile development, 3D printing and electronics. I build apps and smart devices that communicate as a single system.",
    hero_chip: "Focus areas",
    hero_item_1: "Mobile apps with backend integrations",
    hero_item_2: "ESP32 / Arduino Wi-Fi devices",
    hero_item_3: "Functional 3D-printed products",
    btn_appstore: "App Store profile",
    btn_contact: "Contact me",

    about_title: "About me",
    about_body_1:
      "My main focus is 3D printing of functional products that host electronic components and become complete devices. This includes smart lamps, interactive maps and custom housings for IoT projects.",
    about_body_2:
      "As a hobby and for professional growth I use Flutter, Android, iOS and Arduino/ESP32. I enjoy building products where the mobile app, hardware and 3D-printed parts work together as one experience.",

    skills_title: "What I do",
    skill_app_title: "Mobile applications",
    skill_app_body:
      "I develop applications that connect to servers or cloud services. I’m especially interested in tools for clubs, education and controlling smart devices.",
    skill_iot_title: "ESP32 / Arduino devices",
    skill_iot_body:
      "I create firmware for ESP32 and Arduino, integrate LED systems, sensors and Wi-Fi connectivity. Devices may work autonomously or under control of a mobile app.",
    skill_3d_title: "Functional 3D printing",
    skill_3d_body:
      "I design and print housings and both decorative and practical parts for electronics, combining product look with usability and reliability.",

    hobbies_title: "Hobbies & interests",
    hobbies_body:
      "I enjoy combining 3D printing, electronics and coding in single projects. A separate area is LED-based devices: smart lamps, an air-raid alert map of Ukraine and personalized gift products.",

    portfolio_title: "Portfolio (highlights)",
    portfolio_awana_title: "AWANA Helper",
    portfolio_awana_body:
      "A mobile app for AWANA club leaders. It helps plan sessions, games and activities while keeping the structure of each meeting organized.",
    portfolio_map_title: "Ukraine air-raid alert map",
    portfolio_map_body:
      "A smart LED lamp shaped as a map of Ukraine. The device shows regional air-raid alerts in real time and can automatically switch to night-mode brightness.",
    portfolio_lith_title: "3D-printed lithophane lamp",
    portfolio_lith_body:
      "A personalized cube lamp printed as a lithophane. The image becomes visible when the lamp is lit from inside, turning it into an atmospheric gift.",

    contact_title: "Get in touch",
    contact_body:
      "If you need a developer who can bring together 3D printing, electronics and a mobile app in one project, feel free to contact me using the form below.",
    field_name_label: "Name",
    field_email_label: "Email",
    field_message_label: "Message",
    btn_send: "Send message",
    footer_text:
      "© {{year}} Valentyn Yarmolatiy · Mobile apps, 3D printing & IoT solutions",
    form_success: "Thank you! Your message has been sent.",
    form_error:
      "Something went wrong while sending the message. Please try again later.",
    form_sending: "Sending message..."
  }
};

let currentLang = "uk";

function applyTranslations(lang) {
  const dict = translations[lang];
  if (!dict) return;

  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.dataset.i18n;
    let text = dict[key] || "";
    if (key === "footer_text") {
      text = text.replace("{{year}}", new Date().getFullYear());
    }
    el.textContent = text;
  });

  currentLang = lang;
  document.querySelectorAll(".chip--lang").forEach(btn => {
    btn.classList.toggle("active", btn.dataset.lang === lang);
    btn.classList.toggle("chip--outlined", btn.dataset.lang !== lang);
  });
}

function applyTheme(theme) {
  const body = document.body;
  const toggle = document.getElementById("theme-toggle");
  const metaTheme = document.getElementById("meta-theme-color");

  if (theme === "dark") {
    body.classList.add("theme-dark");
    if (toggle) {
      toggle.querySelector(".icon-moon").textContent = "☀";
      toggle.setAttribute("aria-label", "Switch to light theme");
    }
    if (metaTheme) metaTheme.setAttribute("content", "#050816");
  } else {
    body.classList.remove("theme-dark");
    if (toggle) {
      toggle.querySelector(".icon-moon").textContent = "☾";
      toggle.setAttribute("aria-label", "Switch to dark theme");
    }
    if (metaTheme) metaTheme.setAttribute("content", "#f9fafc");
  }
  localStorage.setItem("vy_theme", theme);
}

document.addEventListener("DOMContentLoaded", () => {
  // Language init
  const userLang = navigator.language || navigator.userLanguage;
  const initialLang =
    userLang && userLang.toLowerCase().startsWith("uk") ? "uk" : "en";
  applyTranslations(initialLang);

  document.querySelectorAll(".chip--lang").forEach(btn => {
    btn.addEventListener("click", () => {
      applyTranslations(btn.dataset.lang);
    });
  });

  // Theme init
  const storedTheme = localStorage.getItem("vy_theme");
  const prefersDark = window.matchMedia &&
    window.matchMedia("(prefers-color-scheme: dark)").matches;

  const initialTheme = storedTheme || (prefersDark ? "dark" : "light");
  applyTheme(initialTheme);

  const themeToggle = document.getElementById("theme-toggle");
  if (themeToggle) {
    themeToggle.addEventListener("click", () => {
      const newTheme = document.body.classList.contains("theme-dark")
        ? "light"
        : "dark";
      applyTheme(newTheme);
    });
  }

  // Contact form
  const form = document.getElementById("contact-form");
  const statusEl = document.getElementById("form-status");

  if (form && statusEl) {
    form.addEventListener("submit", async e => {
      e.preventDefault();

      const dict = translations[currentLang];
      statusEl.textContent = dict.form_sending;

      const formData = {
        name: form.name.value.trim(),
        email: form.email.value.trim(),
        message: form.message.value.trim(),
        lang: currentLang
      };

      // TODO: вставити свою URL веб-апа Google Apps Script тут:
      const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxOpuR0EF0j-wEczIo8it1-iluTCpuPI-acIGzPPt2qH0Hp8--vo7tR4VM7X6_b9xr6/exec";

      try {
        await fetch(WEB_APP_URL, {
          method: "POST",
          mode: "no-cors",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(formData)
        });

        statusEl.textContent = dict.form_success;
        form.reset();
      } catch (err) {
        console.error(err);
        statusEl.textContent = dict.form_error;
      }
    });
  }
});
